# ğŸ” æ¬Šé™ç³»çµ±ç¸½è¦½

> **ç¾ä»£åŒ–æ¬Šé™ç³»çµ±æ¶æ§‹èˆ‡ API è¦ç¯„**

## ğŸ¯ ç³»çµ±æ¶æ§‹æ¦‚è¦½

TeamSync æ¬Šé™ç³»çµ±æ¡ç”¨**ä¸‰å±¤æ¶æ§‹è¨­è¨ˆ**ï¼š

1. **ç³»çµ±å±¤**ï¼šåŸºæ–¼è§’è‰²çš„ç³»çµ±æ¬Šé™ (Role-Based Access Control)
2. **åŠŸèƒ½å±¤**ï¼šåŸºæ–¼åŠŸèƒ½æ¨¡çµ„çš„æ¥­å‹™æ¬Šé™ (Feature-Based Permissions)
3. **å‰ç«¯å±¤**ï¼šç¾ä»£åŒ–æ¬Šé™æª¢æŸ¥ Hook ç³»çµ±

---

## ğŸ¢ ç³»çµ±å±¤æ¬Šé™

### ç³»çµ±è§’è‰²èªªæ˜ (role_id)

```js
const SYSTEM_ROLES = {
  VIRTUAL_DEPT_MANAGER: -2, // è™›æ“¬éƒ¨é–€ç®¡ç†è€…
  TESTER: -1, // æ¸¬è©¦å“¡
  GENERAL_EMPLOYEE: 0, // ä¸€èˆ¬å“¡å·¥
  SENIOR_EMPLOYEE: 1, // è³‡æ·±å“¡å·¥
  JUNIOR_MANAGER: 2, // åˆéšç®¡ç†è€…
  MIDDLE_MANAGER: 3, // ä¸­éšç®¡ç†è€…
  SENIOR_MANAGER: 4, // é«˜éšç®¡ç†è€…
};
```

### ç³»çµ±è§’è‰²: ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š.role_id (/private/user/me)

- response

```json
{
  "role_id": 4,
  "role_name": "é«˜éšç®¡ç†è€…",
  "id": "cf3a37eb-e946-4b6a-be81-6bc7ff1fdae7",
  "created_at": "2024-06-29 07:53:16",
  "expired_at": "2216-02-24 07:53:15",
  "photo_url": "https://d3trftidj54e2o.cloudfront.net/Image_User/cf3a37eb-e946-4b6a-be81-6bc7ff1fdae7_1739677071",
  "enabled": true,
  "is_verified": true,
  "username": "admin",
  "email": "test1@example.com",
  "nickname": "0.0",
  "department_id": "23520568-9832-4aed-91f2-916050723672",
  "department_name": "__DEFAULT__",
  "company_id": "858c6f14-54fd-47bb-a169-1ec686f4a02e",
  "company_name": "__TEST_COMPANY__",
  "chatroom_limit": 332,
  "created_rooms": [
    "02008b20-1cb1-4c63-9978-bc7c5763326a",
    "0ca39404-f492-4b05-9c4d-e7a51d64f4f7"
  ],
  "joined_rooms": [
    "02008b20-1cb1-4c63-9978-bc7c5763326a",
    "09c83c8d-b79f-4032-8c7d-93e51293314a"
  ],
  "collected_rooms": [
    "945842c5-3d57-45ba-9f80-26e5cdb520e7",
    "9aa7da4f-5533-4459-8add-1b8a6a713ebd"
  ]
}
```

---

## ğŸ¯ åŠŸèƒ½å±¤æ¬Šé™ (ex. èŠå¤©å®¤)

### ç‰¹å®šåŠŸèƒ½è§’è‰²èªªæ˜

#### èŠå¤©å®¤åŠŸèƒ½è§’è‰²

- **æˆ¿ä¸»** (Creator): å‰µå»ºèŠå¤©å®¤çš„ç”¨æˆ¶
- **æˆ¿é–“ç®¡ç†å“¡** (Manager): å¯æ“ä½œæˆ¿é–“è¨­å®šã€æ¨™ç±¤ç®¡ç†ï¼Œä»¥åŠç¬¬ä¸‰æ–¹ç´€éŒ„çš„è¨­å®šèˆ‡å›è¦†è¨Šæ¯
- **ç¤¾ç¾¤è¨Šæ¯è² è²¬äººå“¡** (Social Manager): å¯æ“ä½œç¬¬ä¸‰æ–¹ç´€éŒ„çš„è¨­å®šèˆ‡å›è¦†è¨Šæ¯

### ğŸ  æˆ¿ä¸»æ¬Šé™åˆ¤å®š

**åˆ¤å®šæ¢ä»¶**: `æˆ¿é–“è³‡è¨Š.creator_id === ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š.id`

**API ç«¯é»**: `/private/chatrooms/{chatroom_id}`

**ç¯„ä¾‹ Response**:

```json
{
  "id": "9aa7da4f-5533-4459-8add-1b8a6a713ebd",
  "created_at": "2025-07-07 02:19:16",
  "department": {
    "id": "23520568-9832-4aed-91f2-916050723672",
    "name": "__DEFAULT__"
  },
  "group_id": "7da6cb54-34ed-47d2-88ce-7bd4f7f3cc19",
  "group": "test",
  "name": "æ¸¬è©¦ ï¼0820",
  "bot_name": "AI åŠ©ç†",
  "photo_url": "https://d3trftidj54e2o.cloudfront.net/Image_ChatRoom/9aa7da4f-5533-4459-8add-1b8a6a713ebd_1757064586",
  "creator_id": "cf3a37eb-e946-4b6a-be81-6bc7ff1fdae7",
  "creator_nickname": "0.0",
  "is_public": true,
  "is_deleted": false,
  "instructions": "ç•¶ä½¿ç”¨è€…å•å€Ÿæ¬¾æ™‚ï¼Œå‘ä½¿ç”¨è€…æœé›†ä»¥ä¸‹è³‡è¨Šï¼šå§“åã€é›»è©±ã€ç”Ÿæ—¥ã€‚\nç•¶è³‡æ–™æœé›†å®Œæˆæ™‚ï¼Œè¦å‘ä½¿ç”¨è€…è©¢å•ã€è«‹å•è³‡æ–™æ˜¯å¦æ­£ç¢ºï¼Ÿã€",
  "num_of_members": 8,
  "num_of_templates": 0,
  "embeddings": "openai/text-embedding-3-large/3072",
  "shared_department": [
    {
      "id": "0e37fd4c-d665-495d-a043-d07947484e10",
      "name": "TEST"
    }
  ],
  "layout_template": "legacy"
}
```

### ğŸ‘¨â€ğŸ’¼ æˆ¿é–“ç®¡ç†å“¡

**API ç«¯é»**: `/private/chatrooms/{chatroom_id}/managers`

**ç¯„ä¾‹ Response**:

```json
{
  "role_id": 0,
  "role_name": "ä¸€èˆ¬å“¡å·¥",
  "id": "bdd1aa24-a0d5-43a2-a096-9e67172f8ac6",
  "nickname": "Henry860104",
  "department_id": "0e37fd4c-d665-495d-a043-d07947484e10",
  "department_name": "TEST",
  "company_id": "858c6f14-54fd-47bb-a169-1ec686f4a02e",
  "company_name": "__TEST_COMPANY__"
}
```

### ğŸŒ ç¤¾ç¾¤è¨Šæ¯è² è²¬äººå“¡

**API ç«¯é»**: `/private/chatrooms/{chatroom_id}/social_media_managers`

**ç¯„ä¾‹ Response**:

```json
{
  "role_id": 0,
  "role_name": "ä¸€èˆ¬å“¡å·¥",
  "id": "bdd1aa24-a0d5-43a2-a096-9e67172f8ac6",
  "nickname": "Henry860104",
  "department_id": "0e37fd4c-d665-495d-a043-d07947484e10",
  "department_name": "TEST",
  "company_id": "858c6f14-54fd-47bb-a169-1ec686f4a02e",
  "company_name": "__TEST_COMPANY__"
}
```

---

## âš¡ å‰ç«¯æ¬Šé™ç³»çµ±

### ğŸ¯ ç¾ä»£åŒ–æ¬Šé™ Hook ç³»çµ±

æˆ‘å€‘å·²ç¶“å¯¦ç¾äº†ç¾ä»£åŒ–çš„æ¬Šé™æª¢æŸ¥ç³»çµ±ï¼Œä½æ–¼ `frontend/src/app/permissions/`ï¼š

#### ğŸ“ ç³»çµ±æ¶æ§‹

```
permissions/
â”œâ”€â”€ README.md              # ğŸ“– å®Œæ•´ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ ARCHITECTURE.md        # ğŸ—ï¸ æ¶æ§‹èªªæ˜
â”œâ”€â”€ index.js              # ğŸ¯ çµ±ä¸€åŒ¯å‡º
â”œâ”€â”€ core/                 # ğŸ”§ æ ¸å¿ƒé‚è¼¯
â”‚   â”œâ”€â”€ constants.js      #   â”œâ”€â”€ ç³»çµ±è§’è‰²å¸¸æ•¸
â”‚   â””â”€â”€ PermissionChecker.js #   â””â”€â”€ æ¬Šé™æª¢æŸ¥æ ¸å¿ƒ
â”œâ”€â”€ modules/              # ğŸ“¦ æ¬Šé™æ¨¡çµ„
â”‚   â”œâ”€â”€ index.js         #   â”œâ”€â”€ æ¨¡çµ„è¨»å†Šä¸­å¿ƒ
â”‚   â”œâ”€â”€ chatroom.js      #   â”œâ”€â”€ èŠå¤©å®¤æ¬Šé™æ¨¡çµ„
â”‚   â””â”€â”€ system.js        #   â””â”€â”€ ç³»çµ±æ¬Šé™æ¨¡çµ„
â””â”€â”€ hooks/               # ğŸ£ React Hooks
    â”œâ”€â”€ usePermissions.js #   â”œâ”€â”€ é€šç”¨æ¬Šé™ Hook
    â”œâ”€â”€ useChatroomPermissions.js # â”œâ”€â”€ èŠå¤©å®¤å°ˆç”¨
    â””â”€â”€ useSystemPermissions.js   # â””â”€â”€ ç³»çµ±å°ˆç”¨
```

#### âœ¨ ç‰¹è‰²åŠŸèƒ½

- **ğŸ¯ é»è™Ÿèªæ³•**: `permissions.chatroom.room.ai.send`
- **âš¡ é«˜æ€§èƒ½**: Proxy + æ™ºèƒ½å¿«å–æ©Ÿåˆ¶
- **ğŸ”§ æ¨¡çµ„åŒ–**: å®Œå…¨å¯æ“´å±•çš„æ¨¡çµ„ç³»çµ±
- **ğŸ“ TypeScript**: å®Œæ•´é¡å‹å®‰å…¨æ”¯æ´
- **ğŸ¨ èªç¾©åŒ–**: æ¬Šé™åç¨±ç›´æ¥å°æ‡‰åŠŸèƒ½

#### ğŸš€ å¿«é€Ÿä½¿ç”¨ç¯„ä¾‹

```javascript
import { useChatroomPermissions } from "app/permissions";

const ChatComponent = ({ room, managers, socialManagers }) => {
  const permissions = useChatroomPermissions({
    room,
    managers,
    socialManagers,
  });

  return (
    <div>
      {/* ğŸ’¬ èŠå¤©å®¤æ¬Šé™ */}
      {permissions.chatroom.room.ai.send && <AISendButton />}
      {permissions.boundRoom.manage && <BoundRoomSettings />}

      {/* âš™ï¸ è¨­å®šæ¬Šé™ */}
      {permissions.chattings.room.edit && <EditSettings />}
      {permissions.chattings.bot.config && <BotConfig />}
    </div>
  );
};
```

---

## ğŸ¯ æ¬Šé™çµæ§‹

### è§’è‰²æ¬Šé™ç­‰ç´š

| ç­‰ç´š   | è§’è‰²åç¨±       | æ¬Šé™ç¯„åœ              |
| ------ | -------------- | --------------------- |
| **4**  | é«˜éšç®¡ç†è€…     | å®Œæ•´ç³»çµ±ç®¡ç†æ¬Šé™      |
| **3**  | ä¸­éšç®¡ç†è€…     | ç³»çµ±ç®¡ç† + èŠå¤©å®¤ç®¡ç† |
| **2**  | åˆéšç®¡ç†è€…     | åŸºç¤èŠå¤©å®¤ç®¡ç†        |
| **1**  | è³‡æ·±å“¡å·¥       | é€²éšèŠå¤©åŠŸèƒ½          |
| **0**  | ä¸€èˆ¬å“¡å·¥       | åŸºæœ¬èŠå¤©åŠŸèƒ½          |
| **-1** | æ¸¬è©¦å“¡         | æ¸¬è©¦æ¬Šé™              |
| **-2** | è™›æ“¬éƒ¨é–€ç®¡ç†è€… | ç‰¹æ®Šéƒ¨é–€æ¬Šé™          |

### ğŸ  èŠå¤©å®¤æ¬Šé™ (`chatroom.*`)

#### ğŸ’¬ ä¸€èˆ¬èŠå¤©å®¤ (`chatroom.room.normal`)

| æ¬Šé™                          | èªªæ˜             | é©ç”¨è§’è‰²                     |
| ----------------------------- | ---------------- | ---------------------------- |
| `chatroom.room.normal.view`   | æŸ¥çœ‹ä¸€èˆ¬èŠå¤©å®¤   | æ‰€æœ‰æˆå“¡                     |
| `chatroom.room.normal.send`   | ç™¼é€ä¸€èˆ¬è¨Šæ¯     | æœ‰æ¬Šé™çš„æˆå“¡                 |
| `chatroom.room.normal.delete` | åˆªé™¤ä¸€èˆ¬è¨Šæ¯     | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡             |
| `chatroom.room.normal.export` | åŒ¯å‡ºä¸€èˆ¬å°è©±ç´€éŒ„ | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |

#### ğŸ¤– AI èŠå¤©å®¤ (`chatroom.room.ai`)

| æ¬Šé™                      | èªªæ˜             | é©ç”¨è§’è‰²                     |
| ------------------------- | ---------------- | ---------------------------- |
| `chatroom.room.ai.view`   | æŸ¥çœ‹ AI èŠå¤©å®¤   | æ‰€æœ‰æˆå“¡                     |
| `chatroom.room.ai.send`   | ç™¼é€ AI è¨Šæ¯     | æœ‰æ¬Šé™çš„æˆå“¡                 |
| `chatroom.room.ai.delete` | åˆªé™¤ AI è¨Šæ¯     | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡             |
| `chatroom.room.ai.export` | åŒ¯å‡º AI å°è©±ç´€éŒ„ | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |

#### ğŸ‘¤ 1 å° 1 èŠå¤©å®¤ (`agentRoom`)

| æ¬Šé™               | èªªæ˜                 | é©ç”¨è§’è‰²                     |
| ------------------ | -------------------- | ---------------------------- |
| `agentRoom.view`   | æŸ¥çœ‹ 1 å° 1 èŠå¤©å®¤   | æ‰€æœ‰æˆå“¡                     |
| `agentRoom.send`   | ç™¼é€ 1 å° 1 è¨Šæ¯     | æœ‰æ¬Šé™çš„æˆå“¡                 |
| `agentRoom.delete` | åˆªé™¤ 1 å° 1 è¨Šæ¯     | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡             |
| `agentRoom.export` | åŒ¯å‡º 1 å° 1 å°è©±ç´€éŒ„ | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |

#### ğŸ”— ç¬¬ä¸‰æ–¹ç´€éŒ„èŠå¤©å®¤ (`boundRoom`)

| æ¬Šé™               | èªªæ˜               | é©ç”¨è§’è‰²                                 |
| ------------------ | ------------------ | ---------------------------------------- |
| `boundRoom.view`   | æŸ¥çœ‹ç¬¬ä¸‰æ–¹ç´€éŒ„     | æœ‰æ¬Šé™çš„æˆå“¡                             |
| `boundRoom.send`   | ç™¼é€ç¬¬ä¸‰æ–¹è¨Šæ¯     | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ã€ç¤¾ç¾¤ç®¡ç†å“¡ |
| `boundRoom.manage` | ç®¡ç†ç¬¬ä¸‰æ–¹æ•´åˆ     | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ã€ç¤¾ç¾¤ç®¡ç†å“¡ |
| `boundRoom.export` | åŒ¯å‡ºç¬¬ä¸‰æ–¹å°è©±ç´€éŒ„ | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ã€ç¤¾ç¾¤ç®¡ç†å“¡ |

### âš™ï¸ èŠå¤©å®¤è¨­å®šæ¬Šé™ (`chattings.*`)

#### ğŸ  åŸºæœ¬æˆ¿é–“è¨­å®š (`chattings.room`)

| æ¬Šé™                   | èªªæ˜                            | é©ç”¨è§’è‰²                     |
| ---------------------- | ------------------------------- | ---------------------------- |
| `chattings.room.view`  | æŸ¥çœ‹æˆ¿é–“åŸºæœ¬è¨­å®š                | æ‰€æœ‰æˆå“¡                     |
| `chattings.room.edit`  | ç·¨è¼¯åŸºæœ¬è¨­å®š (åç¨±ã€é ­åƒã€æè¿°) | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |
| `chattings.room.admin` | ç®¡ç†åŠŸèƒ½ (åˆªé™¤ã€è½‰ç§»æˆ¿ä¸»)       | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |
| `chattings.room.leave` | é›¢é–‹æˆ¿é–“                        | æ‰€æœ‰äºº                       |

#### ğŸ¤– æ©Ÿå™¨äººè¨­å®š (`chattings.bot`)

| æ¬Šé™                   | èªªæ˜                          | é©ç”¨è§’è‰²                     |
| ---------------------- | ----------------------------- | ---------------------------- |
| `chattings.bot.view`   | æŸ¥çœ‹æ©Ÿå™¨äººè¨­å®š                | æ‰€æœ‰æˆå“¡                     |
| `chattings.bot.config` | é…ç½®æ©Ÿå™¨äºº (åç¨±ã€æ¨¡å‹ã€æŒ‡ä»¤) | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |

#### ğŸŒ ç¤¾ç¾¤è¨­å®š (`chattings.social`)

| æ¬Šé™                        | èªªæ˜         | é©ç”¨è§’è‰²                     |
| --------------------------- | ------------ | ---------------------------- |
| `chattings.social.view`     | æŸ¥çœ‹ç¤¾ç¾¤è¨­å®š | æœ‰æ¬Šé™çš„æˆå“¡                 |
| `chattings.social.config`   | ç¤¾ç¾¤æ•´åˆè¨­å®š | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |
| `chattings.social.welcome`  | æ­¡è¿è©è¨­å®š   | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |
| `chattings.social.transfer` | è½‰çœŸäººè¨­å®š   | æˆ¿ä¸»ã€ç³»çµ±ç®¡ç†å“¡ã€æˆ¿é–“ç®¡ç†å“¡ |

### âš™ï¸ ç³»çµ±æ¬Šé™ (`system.*`)

| æ¬Šé™             | èªªæ˜     | é©ç”¨è§’è‰²   |
| ---------------- | -------- | ---------- |
| `system.users`   | ç”¨æˆ¶ç®¡ç† | ç³»çµ±ç®¡ç†å“¡ |
| `system.company` | å…¬å¸è¨­å®š | é«˜éšç®¡ç†è€… |
